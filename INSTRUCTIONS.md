# Инструкция по использованию парсера отзывов 2GIS

## Установка

1. Установите Python 3.8 или выше
2. Перейдите в директорию проекта:
   ```bash
   cd /Users/rus/Projects/reviews-parser
   ```

3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

## Структура проекта

```
reviews-parser/
├── data/                          # Исходные данные
│   └── sandyq_tary_branches.csv  # Список точек продаж
├── output/                        # Результаты парсинга
├── parser.py                      # Основной класс парсера
├── parse_sandyq_tary.py          # Скрипт для парсинга всех точек
├── analyze_reviews.py            # Анализ собранных отзывов
├── test_api.py                   # Тест API 2GIS
├── api.py                        # API для доступа к отзывам
├── config.py                     # Конфигурация
└── requirements.txt              # Зависимости
```

## Использование

### 1. Тестирование API
Проверьте работу API перед полным парсингом:
```bash
python test_api.py
```

### 2. Парсинг всех отзывов
Запустите основной скрипт парсинга:
```bash
python parse_sandyq_tary.py
```

Скрипт:
- Загрузит список точек из CSV файла
- Соберет все отзывы для каждой точки
- Сохранит результаты в форматах CSV и JSON
- Создаст отчет о парсинге

### 3. Анализ результатов
После парсинга запустите анализ:
```bash
python analyze_reviews.py
```

Это создаст:
- Детальный текстовый отчет
- Excel файл со статистикой по точкам
- Визуализацию основных метрик

### 4. Запуск API сервера
Для запуска сервера, который будет предоставлять доступ к отзывам, выполните:
```bash
uvicorn api:app --reload
```
Сервер будет доступен по адресу http://127.0.0.1:8000.
Вы можете получить все отзывы, отправив GET-запрос на http://127.0.0.1:8000/reviews.
Интерактивная документация API будет доступна по адресу http://127.0.0.1:8000/docs.

## Результаты

Все результаты сохраняются в папке `output/`:

- `reviews_sandyq_tary_YYYYMMDD_HHMMSS.csv` - все отзывы в CSV
- `reviews_sandyq_tary_YYYYMMDD_HHMMSS.json` - все отзывы в JSON
- `parse_report_YYYYMMDD_HHMMSS.json` - отчет о парсинге
- `analysis_report_YYYYMMDD_HHMMSS.txt` - детальный анализ
- `branch_statistics_YYYYMMDD_HHMMSS.xlsx` - статистика по точкам

## Формат данных

### CSV с отзывами содержит поля:
- `branch_id` - ID точки в 2GIS
- `branch_name` - название точки
- `review_id` - ID отзыва
- `user_name` - имя пользователя
- `rating` - рейтинг (1-5)
- `text` - текст отзыва
- `date_created` - дата создания
- `date_edited` - дата редактирования
- `is_verified` - подтвержден ли отзыв
- `likes_count` - количество лайков
- `comments_count` - количество комментариев

## Примечания

1. **Ограничения API**: 
   - Между запросами есть задержка 1 секунда
   - Между точками - задержка 2 секунды
   - За один запрос получаем до 50 отзывов

2. **Обработка ошибок**:
   - Точки без ID 2GIS пропускаются
   - Ошибки логируются, парсинг продолжается
   - Создается отчет с информацией об ошибках

3. **Производительность**:
   - Для 26 точек парсинг займет примерно 5-10 минут
   - Зависит от количества отзывов у каждой точки

## Возможные проблемы

1. **Ошибка 429 (Too Many Requests)**:
   - Увеличьте задержки в config.py
   
2. **Ошибка подключения**:
   - Проверьте интернет-соединение
   - Проверьте актуальность API ключа

3. **Пустые результаты**:
   - Проверьте правильность ID точек
   - Убедитесь, что у точки есть отзывы на 2GIS

## Дополнительные возможности

### Парсинг отдельной точки
```python
from parser import TwoGISReviewsParser

parser = TwoGISReviewsParser()
reviews = parser.parse_all_reviews("70000001057699052", "Sandyq Алматы")
parser.save_to_csv(reviews, "output/single_branch.csv")
```

### Изменение параметров
Отредактируйте `config.py` для изменения:
- Размера батча (BATCH_SIZE)
- Задержек между запросами
- Полей для извлечения
