# SESSION LOG - 2025-07-09 19:44

## –ó–∞–¥–∞—á–∞
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ö–∞–Ω–∏–∑–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–∑—ã–≤–æ–≤ –ø–æ –∫–∞–∂–¥–æ–º—É –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é –æ–¥–∏–Ω —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö –æ—Ç–∑—ã–≤–æ–≤. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∫ –æ—Ç–∑—ã–≤–∞–º.

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ ‚è∞
- **–°–æ–∑–¥–∞–Ω `daily_parse.py`** - —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–∑—ã–≤–æ–≤
- **–°–æ–∑–¥–∞–Ω `setup_cron.sh`** - —Å–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
- **–°–æ–∑–¥–∞–Ω `run_daily_parse.sh`** - wrapper –¥–ª—è cron –∑–∞–¥–∞–Ω–∏—è (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π üì∏
- **–û–±–Ω–æ–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å –ë–î** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `photos_count` –∏ `photos_urls`
- **–û–±–Ω–æ–≤–ª–µ–Ω –ø–∞—Ä—Å–µ—Ä** - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∏–∑ API 2GIS
- **–û–±–Ω–æ–≤–ª–µ–Ω API** - –≤–æ–∑–≤—Ä–∞—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ –æ—Ç–≤–µ—Ç–∞—Ö
- **–í—ã–ø–æ–ª–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –ë–î** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –≤ —Ç–∞–±–ª–∏—Ü—É reviews

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CSV —Ñ–∞–π–ª–∞ —Å –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º–∏ üìã
- **–ü–µ—Ä–µ–º–µ—â–µ–Ω CSV —Ñ–∞–π–ª** –∏–∑ –∫–æ—Ä–Ω—è –≤ –ø–∞–ø–∫—É `data/`
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ BOM –∏ –∫–∞–≤—ã—á–µ–∫ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ 23 —Ñ–∏–ª–∏–∞–ª–∞** —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ ID 2GIS

### 4. –ü–æ–ª–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö üîÑ
- **–£–¥–∞–ª–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ** - –æ—á–∏—Å—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü—ã reviews
- **–í—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
- **–ó–∞–≥—Ä—É–∂–µ–Ω–æ 18,753 –æ—Ç–∑—ã–≤–∞** —Å 2,642 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏ (14.1%)

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:
- ‚úÖ **18,753 –æ—Ç–∑—ã–≤–∞** –∑–∞–≥—Ä—É–∂–µ–Ω–æ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **2,642 –æ—Ç–∑—ã–≤–∞ —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏** (14.1% –æ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞)
- ‚úÖ **20 —Ñ–∏–ª–∏–∞–ª–æ–≤** —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ
- ‚úÖ **3 —Ñ–∏–ª–∏–∞–ª–∞** –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã (–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ API 2GIS)

### –¢–æ–ø —Ñ–∏–ª–∏–∞–ª–æ–≤ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ—Ç–∑—ã–≤–æ–≤:
1. **Sandyq –ê–ª–º–∞—Ç—ã** - 3,049 –æ—Ç–∑—ã–≤–æ–≤
2. **Tary –ê—Å—Ç–∞–Ω–∞** - 2,356 –æ—Ç–∑—ã–≤–æ–≤
3. **Tary –ê—é—Å–∞–π** - 1,944 –æ—Ç–∑—ã–≤–∞
4. **Tary –ê–ª–º–∞—Ç—ã** - 1,736 –æ—Ç–∑—ã–≤–æ–≤
5. **Sandyq –ê—Å—Ç–∞–Ω–∞** - 1,374 –æ—Ç–∑—ã–≤–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥:
- **–ù–∞—Å—Ç—Ä–æ–µ–Ω cron job** - –∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00
- **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** - —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –≤ –ø–∞–ø–∫–µ `logs/`
- **–û—Ç—á–µ—Ç—ã** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü—É `parse_reports`

## API Endpoints —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```
GET https://reviews.aqniet.site/api/v1/reviews?branch_id=70000001067929337
```

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
  "review_id": "170620397",
  "branch_id": "70000001067929337",
  "branch_name": "Tary –ê—é—Å–∞–π",
  "user_name": "Dr.Nargiza Yermekovna Yermekovna",
  "rating": 5.0,
  "photos_count": 1,
  "photos_urls": [
    "https://cachizer2.2gis.com/reviews-photos/d3082d7e-fd14-487f-9ca1-79413f3f5b5c.jpg"
  ],
  "text": "–û—Ç–ª–∏—á–Ω–æ–µ –º–µ—Å—Ç–æ —Å –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä–æ–π!",
  "date_created": "2025-07-09T13:20:44.669860",
  "is_verified": false,
  "likes_count": 0,
  "comments_count": 1
}
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:
- `photos_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π (INTEGER)
- `photos_urls` - –º–∞—Å—Å–∏–≤ URL —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π (JSON)

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π:
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ URL –∏–∑ –ø–æ–ª—è `photos.preview_urls.url`
- –§–æ–ª–±—ç–∫ –Ω–∞ `photos.preview_urls.1920x` –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ JSON –º–∞—Å—Å–∏–≤–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

### –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
/root/projects/reviews-parser/
‚îú‚îÄ‚îÄ daily_parse.py          # –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥
‚îú‚îÄ‚îÄ setup_cron.sh           # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ run_daily_parse.sh      # Wrapper –¥–ª—è cron (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ sandyq_tary_branches.csv  # –°–ø–∏—Å–æ–∫ —Ñ–∏–ª–∏–∞–ª–æ–≤
‚îú‚îÄ‚îÄ logs/                   # –õ–æ–≥–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
‚îÇ   ‚îú‚îÄ‚îÄ cron.log           # –õ–æ–≥–∏ cron –∑–∞–¥–∞–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ daily_parse_*.log  # –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
‚îî‚îÄ‚îÄ ...
```

## –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞:
```bash
source venv/bin/activate
python daily_parse.py
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:
```bash
tail -f logs/cron.log
journalctl -u reviews-api.service -f
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ cron:
```bash
crontab -l                    # –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–¥–∞–Ω–∏–π
./setup_cron.sh              # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
./run_daily_parse.sh         # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ wrapper
```

## –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. –ü—Ä–æ–±–ª–µ–º–∞ —Å BOM –≤ CSV —Ñ–∞–π–ª–µ
**–ü—Ä–æ–±–ª–µ–º–∞:** –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∞–ª BOM (Byte Order Mark), —á—Ç–æ –º–µ—à–∞–ª–æ —á—Ç–µ–Ω–∏—é –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `encoding='utf-8-sig'` –∏ –ø–æ–∏—Å–∫ –∫–ª—é—á–µ–π –ø–æ —á–∞—Å—Ç–∏—á–Ω–æ–º—É —Å–æ–≤–ø–∞–¥–µ–Ω–∏—é

### 2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–ª–µ–π —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ API
**–ü—Ä–æ–±–ª–µ–º–∞:** API –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–ª –ø–æ–ª—è `photos_count` –∏ `photos_urls`
**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ API

### 3. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–ª–µ–π –≤ –º–æ–¥–µ–ª–∏ ParseReport
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è –≤ –º–æ–¥–µ–ª–∏
**–†–µ—à–µ–Ω–∏–µ:** –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã:
```bash
curl https://reviews.aqniet.site/health
systemctl status reviews-api.service
docker ps | grep reviews-db
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–∑—ã–≤–æ–≤:
```bash
curl -s "https://reviews.aqniet.site/api/v1/stats" | jq .
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã cron job
2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** - –∞–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
3. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤ –ø—Ä–∏ —Å–±–æ—è—Ö
4. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ  
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 19:44 - 19:53 (9 –º–∏–Ω—É—Ç)  
**–ê–≤—Ç–æ—Ä:** Claude Code  
**–î–∞—Ç–∞:** 2025-07-09